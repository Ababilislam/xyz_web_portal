{{extend 'layout.html'}}

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>

<script>
var base_url=location.protocol + "//" + location.hostname + (location.port && ":" + location.port) + "/{{=request.application}}/";
    
    $(function () {
    
    
    
    $.ajax({
        url: base_url + 'web_order/get_item_name',
        success: function (retStr) {
            zmStr = retStr
            // alert (zmStr)
        }
    });
    
    
    $('#item_name_input').keyup(function () {
    
        // alert("YES")
        //-------------------------
        var ref_list = zmStr.split(',');
        var ref_name = $("#item_name_input").val();
    
        //---------------- auto complete combo list
        var ref_list_new = new Array();
        lc = 0;
        i = 0;
        var refStr = "";
        while (i < ref_list.length) {
            refStr = ref_list[i];
            i = i + 1;
            var res = refStr.toUpperCase().match(ref_name.toUpperCase());
            if (res != null) {
                ref_list_new[lc] = refStr;
                lc = lc + 1;
                if (lc == 30) {
                    break;
                };
            } else {
                continue;
            }
        };
        //alert (ref_list_new);
    
        //-------------- auto complete source
        $("input#item_name_input").autocomplete({
            source: ref_list_new
        });
    
    });
    
    });

 
</script>

<table width="100%"  height="100%"   border="0" cellspacing="0" cellpadding="0" style="background-color:#FFFFFF;" >
 
  <tr  height="1px" >
    <td colspan="3" ></td>
  </tr>

  <tr>
    <td>
    <table border="0" cellspacing="0" cellpadding="0" style="background-color:#FFFFFF;" >
      <tr height="30px" >
        <td width="500" style="background-color:#FFFFFF;" >
          <span class="blackCatTitle">&nbsp;Order details</span>
        </td>
        
        <td width="500" >&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr  height="1px" style="background-color:#CCCCCC;">
        <td colspan="3" ></td>
      </tr>
    </table>

    <table width="100%" align="left" height="100%" border="0"  cellpadding="0" cellspacing="0" style="margin-left:auto;margin-right:auto;background-color:#F5F5F5; font-size: small;" >
      <tr>
        <td height="80%" valign="middle">
                            
        <form  name="form1" action="{{=URL(c='web_order',f='save_order',vars=dict(req_sl=last_order_sl))}}" method="post"  >
          <table width="100%" align="left" cellpadding="2" class="rounded_corner" style="background-color:#F5F5F5">
          
            <tr>
              <td width="100px" style="vertical-align: middle;">Client Name<font style="color:#B93976; font-size:20px">*</font></td>
              <td width="10px" style="font-size: 20px;">:</td>
              <td style="padding-top:5px">
                {{if session.client_name == '' or session.client_name == 'None' or session.client_name == None:}}
                <input type="text" name="Name" id="Name" value="{{=client_name}}" placeholder="Name" style="width:200px" readonly />
                {{else:}}
                <input type="text" name="Name" id="Name" value="{{=session.client_name}}" style="width:200px" readonly />
                {{pass}}
              </td>
            </tr>
          
            <tr>
              <td width="100px" style="vertical-align: middle;">Mobile</td>
              <td width="10px" style="vertical-align: middle;font-size: 20px;">:</td>
              <td style="padding-top:5px">
                {{if session.mobile == '' or session.mobile == 'None' or session.mobile == None:}}
                <input type="text" name="mobile" id="mobile"value="{{=mobile}}" style="width:200px" readonly />
                {{else:}}
                <input type="text" name="mobile" id="mobile" value="{{=session.mobile}}" style="width:200px" readonly />
                {{pass}}
              </td>
            </tr>
            <tr>
              <td width="100px" style="vertical-align: middle;">Address</td>
              <td width="10px" style="vertical-align: middle;font-size: 20px;">:</td>
              <td style="padding-top:5px">
                {{if session.address == '' or session.address == 'None' or session.address == None:}}
                <input type="text" name="address" id="address" value="{{=address}}" placeholder="Address" style="width:200px" readonly />
                {{else:}}
                <input type="text" name="address" id="address" value="{{=session.address}}" placeholder="Address" style="width:200px" readonly />
                {{pass}}
              </td>
            </tr>
            
            
            <tr style="background-color: #f5f5f5;">
              <td> Add Item</td>
              <td width="10px" style="vertical-align: middle;font-size: 20px;">:</td>
              <td style="width: 200px;">
                <input type="text" name="item_name_input" id="item_name_input" placeholder="select item name" autocomplete="off" style="width: 200px;"/>
              </td>
              
              <td><input type="number" name="qty_input"autocomplete="off" placeholder="qty" style="width: 100px;"/>
                &nbsp;
                <input type="submit" name="single_save" id="single_save" value="Add Item"/></td>
              <td></td>
            
            </tr>
          </table>
        </form>    

      <table  border="1" cellpadding="1" cellspacing="2" class="sample_border">
        
        <tr class="blackCatHead" style="background-color: #c4e3ec;">
          <td width="300px" style="vertical-align: middle; padding-left: 10px; height: 30px;">Item Name</td>
          <td width="80px"  style="vertical-align: middle;" align="right">Stock QTY</td>
          <td width="80px"  style="vertical-align: right;">Order QTY</td>
          <td width="80px" align="right">Price</td>
          <td width="80px"  align="right">Vat</td>
          <td width="80px" align="right">Total Amt</td>
          <td colspan="2" width="80px" align="center" >Action</td>
        </tr>

        <!-- #t.id, t.name, t.order_qty, i.stock_quantity, i.price, i.vat_amt -->
         {{ ordqty =0 
          stock_quantity =0
          sub_total=0
          btnstatus=""  
        }}
        {{if len(temp_data)>0:}}
        {{for data in temp_data:
        rec_id =data["id"]
        item =data["name"]
        stock_quantity =data["stock_quantity"]
        price =data["price"]
        vat =data["vat_amt"]
        total_amt=(data['price']+data['vat_amt'])*data['order_qty']
        ordqty = data['order_qty']
        sub_total += total_amt
        }}
        <form  name="form2" action="{{=URL(c='web_order',f='save_order',vars=dict(req_sl=last_order_sl))}}" method="post">
        <tr style="background-color: #f5f5f5;">
          <td style="vertical-align: middle; padding-left: 10px;">{{=item}}</td>
          <td style="vertical-align: middle; padding-left: 10px;" align="right">{{=stock_quantity}}</td>
          {{if ordqty>stock_quantity:
            btnstatus="disabled"  
          }}            
            <td><input type="number" name="qty" align="right" value="{{=data['order_qty']}}" style="color: red;" min="0"/></td>
          {{else:}}
            <td><input type="number" name="qty" align="right" value="{{=data['order_qty']}}" min="0"/></td>
          {{pass}}
          
          <td style="vertical-align: middle; padding-left: 10px;" align="right">{{=price}}</td>
          <td width="80px"  style="vertical-align: middle;" align="right">{{=vat}}</td>
          
          <td width="80px"  style="vertical-align: middle;" align="right">{{=total_amt}}</td>
          <td hidden ><input type="text" name="order_item_{{data}}" value="{{=item}}" align="right"/></td>
          
          <td style="vertical-align: middle;">
            <input type="hidden" name="record_id" id="record_id" value="{{=data['id']}}" />
            <input type="hidden" name="record_name" id="record_name" value="{{=item}}" />
            <input type="submit" name="update_btn" id="update_btn" value="Update" class="button_update" />
            <input type="submit" name="delete_btn" id="delete_btn" value="X" class="button_update" style="border: 1px solid black; background: rgb(240, 237, 237); color: red;" onclick="if (!confirm('Do you really want to Delete this item?')) { return false }"/>
          </td>
        
        </tr>
        </form>

        {{pass}}
        <tr> 
          <td colspan="5" align="right">Total</td>
          <td width="80px"  style="vertical-align: middle;" align="right">{{=sub_total}}</td>
        </tr>
        {{pass}}
        </table>
        <form  name="form2" action="{{=URL(c='web_order',f='save_order',vars=dict(req_sl=last_order_sl))}}" method="post">
          <br>
          <table width="100%" align="left" height="100%" border="0"  cellpadding="0" cellspacing="0" style="margin-left:auto;margin-right:auto;background-color:#F5F5F5; font-size: small;" >
          <tr>
            <td><input type="submit" name="cancel_order" id="save" value="Cancel Order"onclick="if (!confirm('Do you really want to cancle this order?')) { return false }"></td>
            {{if btnstatus=="disabled" :}} 
            <td><input type="submit" name="submit_order" id="save" value="Submit Order" disabled></td>
            {{else:}}
            <td><input type="submit" name="submit_order" id="save" value="Submit Order"></td>
            {{pass}}
          </tr>
        </form>
          
          
          
         
    </table>
  </td>
  </tr>
        
</table>